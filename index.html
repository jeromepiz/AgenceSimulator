<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jeux G√®re - Gestion Agence</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      padding: 30px;
      text-align: center;
      margin: 0;
    }

    h1 {
      color: #2b4a6d;
      font-size: 6vw;
      max-width: 90%;
      margin: auto;
    }

    button {
      margin: 10px;
      padding: 12px 25px;
      font-size: 4vw;
      border: none;
      border-radius: 10px;
      background-color: #4caf50;
      color: white;
      cursor: pointer;
      max-width: 90%;
    }

    button:hover {
      background-color: #45a049;
    }

    .choice-button {
      display: block;
      width: 90%;
      margin: 10px auto;
    }

    #game-container, #role-selection {
      display: none;
      background-color: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      margin-top: 30px;
    }

    #journal {
      text-align: left;
      margin-top: 20px;
      background-color: #eaeaea;
      padding: 15px;
      border-radius: 10px;
      max-width: 100%;
      overflow-x: auto;
    }

    img {
      max-width: 100%;
      height: auto;
    }

    #game-container {
      background-image: url('camion.gif');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
      z-index: 1;
    }

    #game-container::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.85);
      z-index: -1;
    }

    progress {
      width: 100%;
      height: 20px;
    }

    @media screen and (max-width: 768px) {
      h1 {
        font-size: 7vw;
      }

      button {
        font-size: 5vw;
        padding: 10px;
      }

      #feedback-box {
        flex-direction: column;
        align-items: center;
      }

      #feedback {
        max-width: 90%;
        font-size: 4vw;
      }

      #scoreboard table {
        font-size: 4vw;
        width: 100%;
      }

      #playerName {
        font-size: 4vw;
        padding: 10px;
        width: 90%;
      }
    }
  </style>
</head>
<body>
  <div id="welcome-screen">
    <h1>Jeux : Agence Pizzorno Simulator</h1>
    <img alt="Titre" src="Titre.png" style="margin-bottom: 20px;"/>
    <p>Choisis un mode pour commencer :</p>
    <button onclick="startGame()">D√©marrer</button>
    <div style="margin-top: 20px;">
      <label for="playerName">Entrez votre nom :</label><br>
      <input type="text" id="playerName" placeholder="Votre pr√©nom" style="padding: 8px; font-size: 14px; width: 90%;">
    </div>
  </div>

  <div id="role-selection">
    <img src="choix.png" alt="Choix du r√¥le" style="margin-bottom: 20px;"/>
    <h2>D√©marrer la partie</h2>
    <button onclick="selectRole('Jeux s√©curit√©')">Jeux s√©curit√©</button>
    <p id="role-info" style="font-weight: bold; margin-top: 15px;"></p>
    <button id="btn-start-event" onclick="startEvent()" style="display:none;">D√©marrer le jeu</button>
  </div>

  <div id="game-container">
    <h2 id="event-title">√âv√©nement</h2>
    <p id="event-description"></p>

    <div style="margin-bottom: 20px;">
      <label for="reputation-bar">R√©putation :</label><br/>
      <progress id="reputation-bar" max="100" value="5"></progress>
      <p id="reputation-value">5 / 100</p>
    </div>

    <div id="choices-container"></div>

    <div id="feedback-box" style="display: flex; align-items: flex-start; justify-content: center; margin-top: 20px;">
      <img src="avatar.png" alt="avatar" style="width: 80px; height: 80px; margin-right: 15px; border-radius: 50%;">
      <div id="feedback" style="background: #ffffff; border-radius: 15px; padding: 15px; max-width: 500px; box-shadow: 2px 2px 8px rgba(0,0,0,0.2); font-weight: bold; position: relative;">
        <span style="position: absolute; top: 10px; left: -15px; width: 0; height: 0; border-top: 10px solid transparent; border-right: 15px solid #ffffff; border-bottom: 10px solid transparent;"></span>
      </div>
    </div>

    <button id="next-button" onclick="startEvent()" style="display:none;">√âv√©nement suivant</button>
    <button id="restart-button" onclick="restartGame()" style="display:none;">üîÅ Rejouer</button>

    <div id="journal">
      <h3>Journal de partie</h3>
      <ul id="history-log" style="list-style-type: none; padding-left: 0;"></ul>
    </div>
  </div>

  <div id="scoreboard" style="margin-top: 30px;">
    <h3>üèÜ Tableau des scores</h3>
    <table border="1" style="margin: auto; background: white; border-collapse: collapse;">
      <thead>
        <tr><th>Nom</th><th>Score</th><th>M√©daille</th></tr>
      </thead>
      <tbody id="score-rows"></tbody>
    </table>
  </div>
  <script>
  let selectedRole = "";
  let reputation = 5;
  let eventCount = 0;
  let maxEvents = 19;

function fetchScoresFromSheet() {
  const sheetId = "1jl4RbCKiIloNUSSRavaZs4WaUMYF9coLV4HZiHY3Sss";
  const sheetName = "Feuille 1"; // adapte si ton onglet s'appelle autrement
const url = `https://opensheet.elk.sh/${sheetId}/Feuille%201`;

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const rows = data.map(s =>
        `<tr><td>${s.Nom}</td><td>${s.Score}</td><td>${s.M√©daille}</td></tr>`
      ).join('');
      document.getElementById('score-rows').innerHTML = rows;
    });
}


  const roles = {
    "Jeux s√©curit√©": ["Saurez-vous avoir le score maximum ?"],
 
  };

  const eventsByRole = {
    "Jeux s√©curit√©": [
  {
    description: "Il commence √† pleuvoir fort et le sol devient glissant autour du camion.",
    choices: [
      { text: "Je ralentis et adapte ma posture", effect: +5, feedback: "Adaptation logique face au risque de chute" },
      { text: "Je me d√©p√™che pour finir plus vite", effect: -1, feedback: "La pr√©cipitation augmente le risque de chute" },
      { text: "Je demande au conducteur de se rapprocher √† chaque point", effect: +3, feedback: "Bonne strat√©gie pour limiter les d√©placements risqu√©s" },
      { text: "Je continue comme si de rien n‚Äô√©tait", effect: -1, feedback: "Ne pas adapter son comportement est risqu√©" }
    ]
  },
{
  description: "Le l√®ve-conteneur est d√©fectueux et provoque des secousses violentes √† chaque lev√©e.",
  choices: [
    { text: "Je poursuis la tourn√©e pour √©viter le retard", effect: -2, feedback: "Poursuivre avec un √©quipement dangereux aggrave le risque" },
    { text: "Je note le probl√®me et le signale √† la fin", effect: -1, feedback: "Signaler en diff√©r√© est insuffisant pour un risque imm√©diat" },
    { text: "Je contacte imm√©diatement l‚Äôencadrement", effect: +5, feedback: "Bonne gestion d‚Äôun mat√©riel potentiellement dangereux" },
    { text: "Je tente de r√©parer sommairement le syst√®me moi-m√™me", effect: -2, feedback: "Intervention non autoris√©e sur mat√©riel, danger accru" }
  ]
},
  {
    description: "En plein chargement, une benne d√©gage une forte odeur de br√ªl√©.",
    choices: [
      { text: "Je m‚Äô√©loigne et alerte imm√©diatement", effect: +5, feedback: "R√©flexe adapt√© √† un potentiel d√©part de feu" },
      { text: "J‚Äôessaie de voir ce que c‚Äôest avant de r√©agir", effect: -1, feedback: "Priorit√© √† l‚Äô√©vacuation en cas de fum√©e ou odeur suspecte" },
      { text: "Je poursuis le compactage normalement", effect: -2, feedback: "Danger imm√©diat ignor√©" },
      { text: "Je demande √† un coll√®gue de v√©rifier pendant que je continue", effect: -1, feedback: "Le danger reste actif, mauvaise gestion du risque" }
    ]
  },
  {
    description: "Un bac d√©borde de sacs non conformes (gravats, ferraille, etc.).",
    choices: [
      { text: "Je les enl√®ve pour all√©ger le bac et le vider", effect: -2, feedback: "Manipulation interdite de d√©chets dangereux ou lourds" },
      { text: "Je le signale √† la hi√©rarchie et je ne le collecte pas", effect: +5, feedback: "Bonne pratique face √† un contenu interdit" },
      { text: "Je le vide mais sans compacter ensuite", effect: -1, feedback: "Risque de blocage ou de casse mat√©riel" },
      { text: "Je pr√©viens l‚Äôusager avant de le refuser", effect: +3, feedback: "Communication et consigne respect√©e" }
    ]
  },
{
    description: "En fin de tourn√©e, le chauffeur propose de faire un d√©tour non pr√©vu pour √©viter les bouchons.",
    choices: [
      { text: "J'accepte, c‚Äôest plus rapide", effect: -1, feedback: "Modification d‚Äôitin√©raire sans autorisation = non conforme" },
      { text: "Je v√©rifie s‚Äôil y a un impact sur les points de collecte", effect: +3, feedback: "Bonne vigilance sur les cons√©quences du changement" },
      { text: "Je refuse, on ne d√©vie jamais du parcours pr√©vu", effect: 0, feedback: "R√©action rigide, pas forc√©ment adapt√©e √† la situation" },
      { text: "Je pr√©viens l‚Äôencadrement avant de donner mon accord", effect: +5, feedback: "Conforme √† la proc√©dure en cas de modification" }
    ]
  },
  {
    description: "Un usager d√©pose son bac juste apr√®s votre passage et vous le signale en criant.",
    choices: [
      { text: "Je reviens sur mes pas pour vider le bac", effect: -1, feedback: "Revenir √† pied augmente les risques routiers" },
      { text: "Je lui explique calmement qu‚Äôil est trop tard et qu‚Äôil devra attendre la prochaine collecte", effect: +3, feedback: "Bonne communication, respect des r√®gles" },
      { text: "Je l‚Äôignore et poursuis", effect: -1, feedback: "Peut g√©n√©rer frustration et r√©clamation" },
      { text: "Je lui propose de d√©poser son bac plus t√¥t la prochaine fois et accepte de le prendre cette fois-ci", effect: +5, feedback: "Pr√©vention et relation usager constructives" }
    ]
  },
  {
    description: "Un coll√®gue charge les bacs sans attendre que le camion soit totalement √† l‚Äôarr√™t.",
    choices: [
      { text: "Je lui dis de faire attention sans plus", effect: -1, feedback: "Pr√©venir c‚Äôest bien, mais il faut aussi corriger imm√©diatement" },
      { text: "Je le reprends fermement et je pr√©viens l‚Äôencadrement", effect: +5, feedback: "Bonne r√©action √† une situation dangereuse" },
      { text: "Je fais pareil pour ne pas ralentir la tourn√©e", effect: -2, feedback: "Accumulation de risques" },
      { text: "Je propose de prendre sa place pour qu‚Äôil se repose", effect: 1, feedback: "Bonne intention mais ne corrige pas le comportement dangereux" }
    ]
  },
  {
    description: "Un camion benne pr√©sente une fuite hydraulique en cours de tourn√©e.",
    choices: [
      { text: "Je poursuis la tourn√©e sans trop insister sur les commandes", effect: -2, feedback: "Fuite = risque m√©canique et environnemental" },
      { text: "Je pr√©viens imm√©diatement pour signaler l‚Äôanomalie", effect: +5, feedback: "Bonne r√©action face √† une panne potentiellement grave" },
      { text: "J‚Äôessuie la fuite pour limiter les traces au sol", effect: -1, feedback: "Le probl√®me reste actif, action inefficace" },
      { text: "Je d√©connecte la partie hydraulique pour finir manuellement", effect: -2, feedback: "Action non autoris√©e, dangereuse" }
    ]
  },
  {
    description: "En d√©but de service, tu constates que les gants mis √† disposition sont trou√©s.",
    choices: [
      { text: "Je commence quand m√™me, je ferai attention", effect: -1, feedback: "Protection insuffisante = risque direct" },
      { text: "Je signale le probl√®me et demande une nouvelle paire", effect: +5, feedback: "Bonne gestion des EPI d√®s le d√©part" },
      { text: "J‚Äô√©change avec un coll√®gue qui a une paire de secours", effect: +3, feedback: "Solution efficace √† court terme" },
      { text: "Je travaille √† mains nues pour ne pas perdre de temps", effect: -2, feedback: "Interdit, risque de blessure ou contamination" }
    ]
  },
  {
    description: "Ton coll√®gue oublie syst√©matiquement de refermer la benne apr√®s chaque point de collecte.",
    choices: [
      { text: "Je le fais √† sa place, c‚Äôest plus simple", effect: -1, feedback: "Risque de surcharge et projection si benne non ferm√©e" },
      { text: "Je lui rappelle l‚Äôimportance de refermer √† chaque fois", effect: +3, feedback: "Pr√©vention et rappel des bonnes pratiques" },
      { text: "Je le laisse faire, c‚Äôest son probl√®me", effect: -1, feedback: "Ignorer une mauvaise pratique met toute l‚Äô√©quipe en danger" },
      { text: "Je le signale √† l‚Äôencadrement apr√®s plusieurs rappels", effect: +5, feedback: "Action conforme en cas de comportement r√©current" }
    ]
  },
  {
    description: "Un bac √† roulettes est cass√© et penche dangereusement.",
    choices: [
      { text: "Je le vide rapidement et je le repose sans le signaler", effect: -1, feedback: "Risque de chute ou blocage non trait√©" },
      { text: "Je signale l‚Äôanomalie et je refuse la collecte", effect: +5, feedback: "R√©action adapt√©e √† un mat√©riel dangereux" },
      { text: "Je le redresse √† la main pour l‚Äôaccrocher", effect: -1, feedback: "Risque de blessure musculaire" },
      { text: "Je demande au chauffeur de m‚Äôaider √† stabiliser le bac", effect: +1, feedback: "Meilleure gestion en bin√¥me mais reste un risque" }
    ]
  },
  {
    description: "En franchissant un trottoir, tu tr√©buches sans gravit√© mais ta cheville est douloureuse.",
    choices: [
      { text: "Je termine la tourn√©e, ce n‚Äôest pas grave", effect: -1, feedback: "Risque d‚Äôaggravation ou d‚Äôaccident secondaire" },
      { text: "Je pr√©viens imm√©diatement mon chef d‚Äô√©quipe", effect: +5, feedback: "Bonne gestion des incidents corporels" },
      { text: "Je prends une pause de 10 minutes sans rien dire", effect: -1, feedback: "Ne pas signaler un incident peut nuire √† la tra√ßabilit√©" },
      { text: "Je m‚Äôauto-diagnostique et continue prudemment", effect: +1, feedback: "R√©action mod√©r√©e, mais peu fiable" }
    ]
  },
  {
    description: "Un chien errant s‚Äôapproche pendant que tu es derri√®re le camion.",
    choices: [
      { text: "Je reste calme et je remonte dans le camion", effect: +5, feedback: "R√©flexe s√ªr en pr√©sence d‚Äôun animal inconnu" },
      { text: "Je tente de le repousser avec un geste", effect: -1, feedback: "Peut aggraver la r√©action de l‚Äôanimal" },
      { text: "Je le caresse pour le calmer", effect: -2, feedback: "Comportement risqu√© face √† un animal errant" },
      { text: "Je demande √† un usager √† proximit√© de l‚Äô√©loigner", effect: +1, feedback: "Solution indirecte mais pas toujours r√©alisable" }
    ]
  },
  {
    description: "Un container enterr√© semble bloqu√© lors de la lev√©e.",
    choices: [
      { text: "Je force un peu avec la grue pour d√©bloquer", effect: -2, feedback: "Mauvaise pratique pouvant entra√Æner casse ou chute" },
      { text: "J‚Äôarr√™te la man≈ìuvre et je signale le dysfonctionnement", effect: +5, feedback: "R√©action prudente et conforme" },
      { text: "Je redescends doucement puis retente une fois", effect: 1, feedback: "Comportement mod√©r√©, √† surveiller" },
      { text: "Je demande √† mon coll√®gue de venir voir", effect: +1, feedback: "Bonne id√©e d‚Äôavoir un second avis visuel" }
    ]
  },
{
  description: "Tu remarques que ton coll√®gue porte ses chaussures de ville au lieu des chaussures de s√©curit√©.",
  choices: [
    { text: "Je le pr√©viens qu‚Äôil n‚Äôest pas √©quip√© correctement", effect: +5, feedback: "Pr√©vention imm√©diate entre coll√®gues" },
    { text: "Je n‚Äôinterviens pas, il sait ce qu‚Äôil fait", effect: -1, feedback: "Laisser faire met en danger l‚Äô√©quipier" },
    { text: "Je lui propose d‚Äô√©changer nos postes", effect: -1, feedback: "Contournement du probl√®me sans le r√©soudre" },
    { text: "J‚Äôen parle au chef d‚Äô√©quipe d√®s que possible", effect: +3, feedback: "Bonne remont√©e d‚Äôanomalie si le coll√®gue persiste" }
  ]
},
{
  description: "En tournant √† gauche, le chauffeur a une visibilit√© r√©duite par un arbre sur la chauss√©e.",
  choices: [
    { text: "Je descends et je guide la man≈ìuvre", effect: +5, feedback: "Excellente coordination pour s√©curiser la man≈ìuvre" },
    { text: "Je lui dis de faire attention et je reste √† bord", effect: -1, feedback: "Alerte verbale utile mais insuffisante dans ce cas" },
    { text: "Je regarde avec lui depuis la cabine", effect: +1, feedback: "La visibilit√© reste insuffisante sans aide ext√©rieure" },
    { text: "Je propose de changer d‚Äôitin√©raire", effect: -1, feedback: "Bonne intention mais mauvaise pratique" }
  ]
},
{
  description: "Tu vois un bac rempli de bouteilles en verre sans couvercle.",
  choices: [
    { text: "Je le vide prudemment en serrant le bord", effect: -1, feedback: "Risque de coupure √©lev√© sans √©quipement adapt√©" },
    { text: "Je refuse le bac et je le signale", effect: +5, feedback: "Bonne r√©action face √† une pr√©sentation dangereuse" },
    { text: "Je demande √† mon coll√®gue de s‚Äôen occuper", effect: -1, feedback: "Transfert du danger √† autrui" },
    { text: "Je pose un couvercle de fortune avant de le vider", effect: +1, feedback: "Mesure partielle mais non r√©glementaire" }
  ]
},
{
  description: "Pendant le lavage du camion, tu re√ßois des √©claboussures sur le visage.",
  choices: [
    { text: "Je continue, ce n‚Äôest que de l‚Äôeau", effect: -1, feedback: "Risque de projection de produits ou r√©sidus chimiques" },
    { text: "J‚Äôinterromps le lavage et je me rince imm√©diatement", effect: +5, feedback: "R√©action appropri√©e √† une exposition potentielle" },
    { text: "Je mets mes lunettes de s√©curit√© et je continue", effect: +1, feedback: "Bonne id√©e mais un peu tard" },
    { text: "Je me tourne pour √©viter les jets suivants", effect: -1, feedback: "R√©action mod√©r√©e mais temporaire" }
  ]
},
{
  description: "Un agent d√©verse un sac √©ventr√© sans le trier dans une benne de tri s√©lectif.",
  choices: [
    { text: "Je l‚Äôaide pour aller plus vite", effect: -1, feedback: "Mauvais geste renforc√© par solidarit√© mal plac√©e" },
    { text: "Je lui rappelle les consignes de tri", effect: +1, feedback: "Bonne pr√©vention entre coll√®gues" },
    { text: "Je le signale √† l‚Äôencadrement", effect: +5, feedback: "Bonne action si r√©p√©tition ou refus de correction" },
    { text: "Je ne dis rien, ce n‚Äôest pas mon r√¥le", effect: -1, feedback: "La vigilance collective est une responsabilit√© partag√©e" }
  ]
},
{
  description: "Tu es affect√© √† une tourn√©e de nuit inhabituelle et tu te sens fatigu√©.",
  choices: [
    { text: "Je bois plusieurs caf√©s pour rester r√©veill√©", effect: -1, feedback: "La caf√©ine masque la fatigue mais ne supprime pas le risque" },
    { text: "Je demande √† √™tre remplac√© si je ne me sens pas en √©tat", effect: +5, feedback: "Priorit√© √† la s√©curit√© personnelle et collective" },
    { text: "Je r√©duis la vitesse pour compenser", effect: -1, feedback: "Ne traite pas la cause" },
    { text: "Je m‚Äôisole et fais une micro-sieste sans pr√©venir", effect: -1, feedback: "Isolement non encadr√© peut poser probl√®me" }
  ]
},
{
  description: "En plein service, tu te rends compte que tu as oubli√© ton t√©l√©phone personnel sur ton lieu de pause.",
  choices: [
    { text: "Je retourne discr√®tement le chercher", effect: -1, feedback: "D√©placement inutile sans urgence" },
    { text: "Je continue la tourn√©e et j‚Äôattends la pause", effect: +5, feedback: "Bonne gestion des priorit√©s pendant le service" },
    { text: "Je demande au chauffeur de faire un d√©tour", effect: -1, feedback: "Itin√©raire modifi√© sans raison professionnelle" },
    { text: "Je pr√©viens le chef d'√©quipe pour l'avertir", effect: +1, feedback: "R√©action correcte mais d√©pend du contexte" }
  ]
},
{
  description: "Un riverain te signale la pr√©sence d‚Äôun nid de gu√™pes dans un conteneur.",
  choices: [
    { text: "Je le vide tr√®s vite pour √©viter le danger", effect: -2, feedback: "Risque d‚Äôattaque pendant la manipulation" },
    { text: "Je refuse de le collecter et je signale l‚Äôanomalie", effect: +5, feedback: "Bonne application du principe de pr√©caution" },
    { text: "Je l‚Äôarrose avec de l‚Äôeau pour les faire partir", effect: -1, feedback: "Inefficace et risqu√©" },
    { text: "Je propose de repasser en fin de tourn√©e", effect: -1, feedback: "Le probl√®me ne sera pas r√©solu d'ici la" }
  ]
},

],

    "Responsable RH": [
{
  description: "Deux agents refusent de travailler ensemble.",
  choices: [
    { text: "M√©diation RH imm√©diate", effect: +10, feedback: "Le conflit se d√©samorce, le climat de travail s'am√©liore." },
    { text: "Ignorer la situation", effect: -10, feedback: "Le conflit empire et impacte la qualit√© du service." },
    { text: "Changer les affectations", effect: +5, feedback: "La tension baisse, mais cela d√©sorganise les √©quipes." },
    { text: "R√©union collective obligatoire", effect: -5, feedback: "Per√ßu comme forc√©, les tensions restent vives." },
    { text: "Sanctionner un agent", effect: -8, feedback: "La sanction est mal v√©cue, le malaise grandit." },
    { text: "√âcoute individuelle", effect: +8, feedback: "Bonne prise en compte des ressentis des deux agents." }
  ]
},
{
  description: "Un agent demande un am√©nagement de poste.",
  choices: [
    { text: "√âtude m√©dicale et poste adapt√©", effect: +10, feedback: "Excellente gestion conforme aux obligations l√©gales." },
    { text: "Refus direct", effect: -15, feedback: "D√©cision ill√©gale, plainte possible du salari√©." },
    { text: "Proposition partielle", effect: +5, feedback: "L'agent accepte mais reste frustr√©." },
    { text: "Reporter la d√©cision", effect: -5, feedback: "L'inaction cr√©e du ressentiment chez l'agent." },
    { text: "Rencontre avec le manager", effect: +8, feedback: "Bonne concertation tripartite pour trouver une solution." },
    { text: "Ignorer la demande", effect: -10, feedback: "L‚Äôagent envisage un recours externe." }
  ]
},
{
  description: "Un salari√© signale du harc√®lement moral.",
  choices: [
    { text: "Lancer imm√©diatement une enqu√™te interne", effect: +10, feedback: "Bonne gestion conforme au devoir de vigilance." },
    { text: "Demander au manager de g√©rer seul", effect: -10, feedback: "Manque de neutralit√© et de proc√©dure." },
    { text: "Organiser des entretiens individuels", effect: +8, feedback: "Les faits sont mieux compris et clarifi√©s." },
    { text: "Minimiser les faits", effect: -15, feedback: "Le salari√© perd confiance et alerte l‚Äôinspection du travail." },
    { text: "Isoler le salari√© temporairement", effect: -5, feedback: "D√©cision contre-productive et mal interpr√©t√©e." },
    { text: "Proposer une m√©diation externe", effect: +5, feedback: "Bonne option de neutralit√© dans un climat tendu." }
  ]
},
{
  description: "Un salari√© revient d‚Äôun long arr√™t maladie.",
  choices: [
    { text: "Mettre en place une visite de reprise", effect: +10, feedback: "D√©marche obligatoire respect√©e." },
    { text: "Le r√©int√©grer sans adaptation", effect: -10, feedback: "Mise en danger potentielle du salari√©." },
    { text: "Demander un entretien RH", effect: +8, feedback: "Bonne pratique d‚Äôaccompagnement au retour." },
    { text: "Lui confier imm√©diatement une tourn√©e", effect: -8, feedback: "Reprise trop brutale, risque de rechute." },
    { text: "R√©partir ses t√¢ches avec l‚Äô√©quipe", effect: +5, feedback: "Bonne transition en douceur." },
    { text: "Attendre qu‚Äôil demande quelque chose", effect: -5, feedback: "Manque d‚Äôinitiative RH sur le suivi." }
  ]
},
{
  description: "Un agent cumule les retards r√©p√©t√©s.",
  choices: [
    { text: "Le convoquer pour un entretien disciplinaire", effect: +10, feedback: "D√©marche formelle et claire." },
    { text: "Ignorer la situation", effect: -10, feedback: "Cela cr√©e un effet d‚Äôinjustice dans l‚Äô√©quipe." },
    { text: "Avertissement oral informel", effect: +5, feedback: "Bonne premi√®re √©tape de dialogue." },
    { text: "Modifier son planning en secret", effect: -5, feedback: "Per√ßu comme injuste par les coll√®gues." },
    { text: "V√©rifier un √©ventuel souci personnel", effect: +8, feedback: "Bonne √©coute avant sanction." },
    { text: "D√©duire les retards de son salaire", effect: -8, feedback: "D√©cision contestable sans proc√©dure pr√©alable." }
  ]
},
{
  description: "Plusieurs CDD arrivent √† √©ch√©ance bient√¥t.",
  choices: [
    { text: "Anticiper avec les managers", effect: +10, feedback: "Bonne planification des besoins √† venir." },
    { text: "Attendre la derni√®re minute", effect: -10, feedback: "Difficult√©s √† renouveler ou remplacer les postes." },
    { text: "Informer les int√©ress√©s t√¥t", effect: +8, feedback: "Les agents appr√©cient la transparence." },
    { text: "Transformer en CDI sans √©change", effect: -5, feedback: "Les managers sont mis devant le fait accompli." },
    { text: "R√©aliser un bilan d'int√©gration", effect: +6, feedback: "Bonne occasion de valoriser les agents." },
    { text: "Demander aux chefs d‚Äô√©quipe de trancher seuls", effect: -8, feedback: "Manque d‚Äô√©quit√© et d‚Äôapproche RH." }
  ]
},
{
  description: "Un agent vous interpelle sur son salaire.",
  choices: [
    { text: "V√©rifier la fiche de paie", effect: +10, feedback: "Erreur d√©tect√©e et corrig√©e rapidement." },
    { text: "√âviter la discussion", effect: -10, feedback: "Le salari√© se sent m√©pris√©." },
    { text: "Donner une explication imm√©diate", effect: +8, feedback: "Le salari√© comprend la situation." },
    { text: "Reporter la discussion √† plus tard", effect: -5, feedback: "Le salari√© repart frustr√©." },
    { text: "Transf√©rer au service paie sans suivi", effect: -8, feedback: "L‚Äôagent reste dans le flou." },
    { text: "Proposer un point formel avec preuves", effect: +6, feedback: "La transparence est appr√©ci√©e." }
  ]
},
{
  description: "Tensions persistantes entre deux services.",
  choices: [
    { text: "Organiser une r√©union interservices", effect: +10, feedback: "Dialogue renou√©, solutions concr√®tes trouv√©es." },
    { text: "Laisser les responsables g√©rer seuls", effect: -8, feedback: "Les tensions empirent faute de pilotage RH." },
    { text: "Changer les agents de poste", effect: -5, feedback: "D√©cision non concert√©e, peu efficace." },
    { text: "Faire appel √† un m√©diateur externe", effect: +8, feedback: "Approche neutre bien accueillie." },
    { text: "Ignorer les plaintes", effect: -10, feedback: "L‚Äôambiance de travail se d√©grade fortement." },
    { text: "Proposer une enqu√™te de climat social", effect: +5, feedback: "Outil utile pour objectiver les tensions." }
  ]
},
{
  description: "Un agent refuse une formation obligatoire.",
  choices: [
    { text: "Lui rappeler ses obligations", effect: +10, feedback: "Le salari√© comprend et se conforme." },
    { text: "Annuler la formation pour lui", effect: -10, feedback: "D√©cision injuste pour les autres." },
    { text: "Rencontrer l‚Äôagent pour comprendre", effect: +8, feedback: "Un blocage personnel est lev√©." },
    { text: "Proposer une alternative de date", effect: +5, feedback: "Bonne solution souple." },
    { text: "Le sanctionner sans √©change", effect: -8, feedback: "D√©cision pr√©cipit√©e mal v√©cue." },
    { text: "Ignorer son refus", effect: -5, feedback: "Pas de r√©action = d√©sengagement." }
  ]
},
{
  description: "Le tableau de suivi des visites m√©dicales n‚Äôest pas √† jour.",
  choices: [
    { text: "Mettre √† jour imm√©diatement", effect: +10, feedback: "Obligation l√©gale respect√©e." },
    { text: "Reporter au mois suivant", effect: -5, feedback: "Risque de contr√¥le et rappel URSSAF." },
    { text: "Laisser le prestataire g√©rer seul", effect: -8, feedback: "Pas de suivi RH fiable." },
    { text: "Relancer les agents concern√©s", effect: +6, feedback: "Bonne anticipation avant √©ch√©ance." },
    { text: "Faire un point avec le m√©decin du travail", effect: +8, feedback: "Coordination utile et rigoureuse." },
    { text: "Ignorer le probl√®me", effect: -10, feedback: "Agents non vus depuis des ann√©es." }
  ]
}
],

    "Responsable QSE": [
      {
        description: "Un agent chute sur le quai de transfert.",
        choices: [
          { text: "Ouvrir une enqu√™te imm√©diate", effect: +10, feedback: "Tr√®s bonne r√©activit√© s√©curit√©." },
          { text: "Bl√¢mer l‚Äôagent pour inattention", effect: -10, feedback: "Peu p√©dagogique." },
          { text: "Mettre √† jour le DUERP", effect: +5, feedback: "Bonne trace √©crite." },
          { text: "Organiser une causerie s√©curit√©", effect: +8, feedback: "Excellente initiative." },
          { text: "Ne rien faire", effect: -15, feedback: "Inacceptable." },
          { text: "Ajouter un marquage au sol", effect: +5, feedback: "Mesure pr√©ventive utile." }
        ]
      },
      {
        description: "Des d√©chets dangereux ont √©t√© trouv√©s m√©lang√©s aux ordures.",
        choices: [
          { text: "Isoler le contenant et informer l‚Äô√©quipe", effect: +10, feedback: "Bonne gestion imm√©diate." },
          { text: "Ignorer", effect: -15, feedback: "Grave manquement QSE." },
          { text: "Contacter le client fautif", effect: +5, feedback: "Bonne communication." },
          { text: "R√©aliser un affichage p√©dagogique", effect: +8, feedback: "Bonne pr√©vention." },
          { text: "Demander une sanction", effect: -5, feedback: "R√©action excessive." },
          { text: "Notifier la direction", effect: +5, feedback: "Bonne transparence." }
        ]
      }
    ],
    "Responsable d‚Äôatelier": [
      {
        description: "Une benne l√®ve-conteneurs ne fonctionne plus.",
        choices: [
          { text: "V√©rifier la pompe hydraulique", effect: +10, feedback: "Tr√®s bon r√©flexe technique." },
          { text: "Demander une pi√®ce sans diagnostic", effect: -5, feedback: "Proc√©dure incompl√®te." },
          { text: "Reporter la r√©paration", effect: -10, feedback: "Mauvaise gestion." },
          { text: "Affecter un autre v√©hicule", effect: +5, feedback: "Bonne alternative temporaire." },
          { text: "Informer le conducteur", effect: +8, feedback: "Bonne communication." },
          { text: "Ignorer", effect: -15, feedback: "Dangereux et inefficace." }
        ]
      },
      {
        description: "Un agent signale un bruit √©trange sur son camion.",
        choices: [
          { text: "Contr√¥ler imm√©diatement", effect: +10, feedback: "Excellent r√©flexe s√©curit√©." },
          { text: "Faire rouler quand m√™me", effect: -15, feedback: "Tr√®s risqu√©." },
          { text: "Reprogrammer la tourn√©e avec un autre v√©hicule", effect: +5, feedback: "Bonne adaptation." },
          { text: "Demander un test √† vide", effect: +8, feedback: "D√©marche prudente." },
          { text: "Reporter l‚Äôintervention", effect: -5, feedback: "Pas id√©al." },
          { text: "Remettre en service sans v√©rif", effect: -10, feedback: "D√©cision dangereuse." }
        ]
      }
    ],
    "Agent de ma√Ætrise": [
      {
        description: "Un √©quipier refuse de suivre son planning.",
        choices: [
          { text: "Le rencontrer pour comprendre", effect: +10, feedback: "Tr√®s bon leadership." },
          { text: "Le forcer √† l‚Äôappliquer", effect: -10, feedback: "Trop autoritaire." },
          { text: "R√©adapter les √©quipes", effect: +5, feedback: "Bonne gestion collective." },
          { text: "Informer les RH", effect: +8, feedback: "Bonne coordination." },
          { text: "Ignorer la situation", effect: -10, feedback: "Conflit potentiel." },
          { text: "Changer tout le planning", effect: -5, feedback: "Peu optimal." }
        ]
      },
      {
        description: "Un agent signale un manque de mat√©riel EPI.",
        choices: [
          { text: "R√©approvisionner imm√©diatement", effect: +10, feedback: "Priorit√© s√©curit√© respect√©e." },
          { text: "Dire d‚Äôutiliser un ancien", effect: -10, feedback: "Inacceptable." },
          { text: "Pr√©venir le responsable QSE", effect: +5, feedback: "Bonne coop√©ration." },
          { text: "Reporter la tourn√©e", effect: +8, feedback: "Mesure prudente." },
          { text: "Bl√¢mer l‚Äôagent", effect: -8, feedback: "Injuste." },
          { text: "Ignorer", effect: -15, feedback: "Grave erreur." }
        ]
      }
    ],
    "Chef d‚Äô√©quipe": [
      {
        description: "Un √©quipier revient sans avoir collect√© un bac signal√©.",
        choices: [
          { text: "V√©rifier l‚Äôinfo et renvoyer l‚Äô√©quipe", effect: +10, feedback: "Tr√®s bonne rigueur." },
          { text: "Noter sans agir", effect: -10, feedback: "Pas de correction." },
          { text: "Appeler le client", effect: +5, feedback: "Bonne communication." },
          { text: "Bl√¢mer l‚Äô√©quipier devant tous", effect: -10, feedback: "Pas de bonne pratique." },
          { text: "Ajouter l‚Äôadresse au lendemain", effect: +8, feedback: "Mesure r√©active." },
          { text: "Ignorer", effect: -15, feedback: "Erreur client non trait√©e." }
        ]
      },
      {
        description: "Un agent refuse de monter √† l‚Äôarri√®re du camion sans gants.",
        choices: [
          { text: "Fournir les EPI manquants", effect: +10, feedback: "Parfait." },
          { text: "Lui dire de monter quand m√™me", effect: -15, feedback: "Mise en danger." },
          { text: "Reporter la tourn√©e", effect: +5, feedback: "Solution prudente." },
          { text: "Demander √† un rempla√ßant", effect: +8, feedback: "R√©activit√© OK." },
          { text: "Bl√¢mer l‚Äôagent", effect: -10, feedback: "Injuste." },
          { text: "Ignorer", effect: -15, feedback: "Inacceptable." }
        ]
      }
    ]
  };

function startGame() {
  const nameInput = document.getElementById('playerName').value.trim();
  if (nameInput === "") {
    alert("Veuillez entrer votre nom avant de commencer !");
    return;
  }
  window.currentPlayerName = nameInput;

  // Cacher l'√©cran de bienvenue
  document.getElementById('welcome-screen').style.display = 'none';

  // Afficher l'√©cran de s√©lection de r√¥le
  document.getElementById('role-selection').style.display = 'block';
}



  function selectRole(role) {
    selectedRole = role;
    document.getElementById('role-info').innerText =
      `${role} ‚Äì  : ${roles[role][0]} `;
    document.getElementById('btn-start-event').style.display = 'inline-block';
  }

  function startEvent() {
    eventCount++;
    if (eventCount > maxEvents || reputation <= 0) return endGame();

    document.getElementById('role-selection').style.display = 'none';
    document.getElementById('game-container').style.display = 'block';
   document.getElementById('feedback').innerText = "";
document.getElementById('choices-container').innerHTML = "";
document.getElementById('next-button').style.display = 'none';


    const events = eventsByRole[selectedRole];
    const randomEvent = events[Math.floor(Math.random() * events.length)];
    document.getElementById('event-title').innerText = selectedRole;
    document.getElementById('event-description').innerText = randomEvent.description;

    randomEvent.choices.forEach(choice => {
      const btn = document.createElement('button');
      btn.innerText = choice.text;
      btn.className = 'choice-button';
      btn.onclick = function () {
        handleChoice(choice);
      };
      document.getElementById('choices-container').appendChild(btn);
    });
  }

  function handleChoice(choice) {
    reputation = Math.max(0, Math.min(100, reputation + choice.effect));
    document.getElementById('reputation-bar').value = reputation;
    document.getElementById('reputation-value').innerText = `${reputation} / 100`;
    document.getElementById('feedback').innerText = choice.feedback;

    const allButtons = document.querySelectorAll('.choice-button');
    allButtons.forEach(btn => btn.disabled = true);

    document.getElementById('next-button').style.display = 'inline-block';

    const log = document.createElement('li');
    log.innerText = `üéØ ${document.getElementById('event-description').innerText} ‚Üí ‚úÖ ${choice.text} [R√©putation : ${reputation}]`;
    document.getElementById('history-log').appendChild(log);
  }

function endGame() {
  document.getElementById('feedback').innerText = "üéâ Fin de la partie !";
  document.getElementById('choices-container').innerHTML = "";
  document.getElementById('next-button').style.display = 'none';

  let medal = "";
  let color = "";
  let image = "";

  if (reputation === 0) {
    medal = "üí• √âchec total ‚Äì L‚Äôagence ferme ses portes !";
    color = "darkred";
    image = "fermeture.png";
  } else if (reputation >= 90) {
    medal = "ü•á M√©daille d'OR";
    color = "gold";
    image = "podium.png";
  } else if (reputation >= 70) {
    medal = "ü•à M√©daille d'ARGENT";
    color = "silver";
    image = "podium.png";
  } else {
    medal = "ü•â M√©daille de BRONZE";
    color = "#cd7f32";
    image = "podium.png";
  }

  const resultText = `
    üö© Partie termin√©e apr√®s ${eventCount} √©v√©nements.<br>
    Score final : ${reputation}/100<br>
    <span style="font-size: 22px; color: ${color}; font-weight: bold;">${medal}</span><br>
    <img src="${image}" alt="r√©sultat final" style="margin-top: 15px; max-width: 400px;">
  `;

  document.getElementById('feedback').innerHTML = resultText;

  const endLog = document.createElement('li');
  endLog.innerHTML = resultText;
  document.getElementById('history-log').appendChild(endLog);
  saveScore(window.currentPlayerName, reputation, medal);

  document.getElementById('restart-button').style.display = 'inline-block';
}

function restartGame() {
  reputation = 5;
  eventCount = 0;
  document.getElementById('reputation-bar').value = reputation;
  document.getElementById('reputation-value').innerText = "5 / 100";
  document.getElementById('history-log').innerHTML = "";
  document.getElementById('feedback').innerHTML = "";
  document.getElementById('choices-container').innerHTML = "";
  document.getElementById('next-button').style.display = 'none';
  document.getElementById('restart-button').style.display = 'none';
  document.getElementById('role-selection').style.display = 'block';
  document.getElementById('game-container').style.display = 'none';
}
function saveScore(name, score, medal) {
  fetch("https://script.google.com/macros/s/AKfycbzjvtoIp9X7vk5R0WzeAJa7kyQQdR5D8NyAViGVxtBQ62G0rcSqB81v0OCBx5WFQesx/exec", {
    method: "POST",
    mode: "no-cors",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      name: name,
      score: score,
      medal: medal
    }),
  });
}




// Appel automatique √† l'ouverture de la page
window.onload = function () {
  fetchScoresFromSheet();
};



</script>
</body>
</html>
