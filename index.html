<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Jeux G√®re - Gestion Agence</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      padding: 30px;
      text-align: center;
    }
    h1 {
      color: #2b4a6d;
    }
    button {
      margin: 10px;
      padding: 12px 25px;
      font-size: 15px;
      border: none;
      border-radius: 10px;
      background-color: #4caf50;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .choice-button {
      display: block;
      width: 80%;
      margin: 10px auto;
    }
    #game-container, #role-selection {
      display: none;
      background-color: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      margin-top: 30px;
    }
    #journal {
      text-align: left;
      margin-top: 20px;
      background-color: #eaeaea;
      padding: 15px;
      border-radius: 10px;
    }

#game-container {
  background-image: url('camion.gif');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  position: relative;
  z-index: 1;
}
#game-container::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,0.85);
  z-index: -1;
}
  </style>
</head>
<body>
<div id="welcome-screen">
  <h1>Jeux : Agence Pizzorno Simulator</h1>
  <img alt="Titre" src="Titre.png" style="width: 600px; margin-bottom: 20px;"/>
  <p>Choisis un mode pour commencer :</p>
  <button onclick="startGame()">D√©marrer</button>

<div style="margin-top: 20px;">
  <label for="playerName">Entrez votre nom :</label><br>
  <input type="text" id="playerName" placeholder="Votre pr√©nom" style="padding: 8px; font-size: 14px;">
</div>
</div>

  <div id="role-selection">
 <img src="choix.png" alt="Choix du r√¥le" style="max-width: 600px; margin-bottom: 20px;"/>
    <h2>Choisis ton r√¥le</h2>

    <button onclick="selectRole('Responsable d‚Äôagence')">Responsable d‚Äôagence</button>
    <button onclick="selectRole('Responsable RH')">Responsable RH</button>
    <button onclick="selectRole('Responsable QSE')">Responsable QSE</button>
    <button onclick="selectRole('Responsable d‚Äôatelier')">Responsable d‚Äôatelier</button>
    <button onclick="selectRole('Agent de ma√Ætrise')">Agent de ma√Ætrise</button>
    <button onclick="selectRole('Chef d‚Äô√©quipe')">Chef d‚Äô√©quipe</button>
    <p id="role-info" style="font-weight: bold; margin-top: 15px;"></p>
    <button id="btn-start-event" onclick="startEvent()" style="display:none;">D√©marrer le jeu</button>
  </div>
  <div id="game-container">
    <h2 id="event-title">√âv√©nement</h2>
    <p id="event-description"></p>

    <div style="margin-bottom: 20px;">
      <label for="reputation-bar">R√©putation :</label><br/>
      <progress id="reputation-bar" max="100" style="width: 80%; height: 20px;" value="50"></progress>
      <p id="reputation-value">50 / 100</p>
    </div>

    <div id="choices-container"></div>

<div id="feedback-box" style="display: flex; align-items: flex-start; justify-content: center; margin-top: 20px;">
  <img src="avatar.png" alt="avatar" style="width: 80px; height: 80px; margin-right: 15px; border-radius: 50%;">
  <div id="feedback" style="background: #ffffff; border-radius: 15px; padding: 15px; max-width: 500px; box-shadow: 2px 2px 8px rgba(0,0,0,0.2); font-weight: bold; position: relative;">
    <span style="position: absolute; top: 10px; left: -15px; width: 0; height: 0; border-top: 10px solid transparent; border-right: 15px solid #ffffff; border-bottom: 10px solid transparent;"></span>
  </div>
</div>


    <button id="next-button" onclick="startEvent()" style="display:none;">√âv√©nement suivant</button>
<button id="restart-button" onclick="restartGame()" style="display:none;">üîÅ Rejouer</button>


    <div id="journal">
      <h3>Journal de partie</h3>
      <ul id="history-log" style="list-style-type: none; padding-left: 0;"></ul>
    </div>
  </div>
<div id="scoreboard" style="margin-top: 30px;">
  <h3>üèÜ Tableau des scores</h3>
  <table border="1" style="margin: auto; background: white; border-collapse: collapse;">
    <thead>
      <tr><th>Nom</th><th>Score</th><th>M√©daille</th></tr>
    </thead>
    <tbody id="score-rows">
    </tbody>
  </table>
</div>
  <script>
  let selectedRole = "";
  let reputation = 50;
  let eventCount = 0;
  let maxEvents = 5;

function fetchScoresFromSheet() {
  const sheetId = "2PACX-1vTkqzqMaUbIEyQPh7S10D4M_UIhvQf9-jvBXzZ3hi9BGoXvWMP_J2tTQQX_VrmQHH41IGiyaqcslXBZ";
  const sheetName = "Feuille 1"; // adapte si ton onglet s'appelle autrement
  const url = `https://opensheet.elk.sh/${sheetId}/${sheetName}`;

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const rows = data.map(s =>
        `<tr><td>${s.Nom}</td><td>${s.Score}</td><td>${s.M√©daille}</td></tr>`
      ).join('');
      document.getElementById('score-rows').innerHTML = rows;
    });
}


  const roles = {
    "Responsable d‚Äôagence": ["Planification strat√©gique", "Gestion budg√©taire"],
    "Responsable RH": ["N√©gociation sociale", "Gestion des conflits"],
    "Responsable QSE": ["Analyse des risques", "Animation s√©curit√©"],
    "Responsable d‚Äôatelier": ["Diagnostic technique", "Gestion des pi√®ces"],
    "Agent de ma√Ætrise": ["Organisation des tourn√©es", "Suivi terrain"],
    "Chef d‚Äô√©quipe": ["Encadrement des agents", "R√©activit√© op√©rationnelle"]
  };

  const eventsByRole = {
    "Responsable d‚Äôagence": [
      {
        description: "Le client se plaint de collectes non r√©alis√©es.",
        choices: [
          { text: "Envoyer une √©quipe d‚Äôastreinte", effect: +10, feedback: "Bonne r√©activit√©." },
          { text: "Reporter au lendemain", effect: -5, feedback: "Client d√©√ßu du d√©lai." },
          { text: "Bl√¢mer un chef d‚Äô√©quipe", effect: -10, feedback: "Manque de leadership." },
          { text: "Contacter le client pour dialogue", effect: +5, feedback: "Bonne communication." },
          { text: "Ignorer le probl√®me", effect: -15, feedback: "Image d√©grad√©e." },
          { text: "Proposer un geste commercial", effect: +8, feedback: "Bien vu." }
        ]
      },
      {
        description: "Le budget maintenance est d√©pass√© de 25‚ÄØ%.",
        choices: [
          { text: "R√©duire les entretiens", effect: -10, feedback: "Risque de panne accru." },
          { text: "R√©union avec l‚Äôatelier", effect: +10, feedback: "Bonne gestion collective." },
          { text: "Reporter les co√ªts", effect: -5, feedback: "D√©cision risqu√©e." },
          { text: "Bl√¢mer un service", effect: -10, feedback: "Tension inutile." },
          { text: "R√©viser les budgets", effect: +5, feedback: "Bonne anticipation." },
          { text: "Informer la direction", effect: +8, feedback: "Bonne transparence." }
        ]
      }
    ],
    "Responsable RH": [
      {
        description: "Deux agents refusent de travailler ensemble.",
        choices: [
          { text: "M√©diation RH imm√©diate", effect: +10, feedback: "Bonne gestion du conflit." },
          { text: "Ignorer la situation", effect: -10, feedback: "Climat social d√©t√©rior√©." },
          { text: "Changer les affectations", effect: +5, feedback: "Bonne adaptation." },
          { text: "R√©union collective obligatoire", effect: -5, feedback: "Per√ßu comme forc√©." },
          { text: "Sanctionner un agent", effect: -8, feedback: "Injuste." },
          { text: "√âcoute individuelle", effect: +8, feedback: "Bonne √©coute." }
        ]
      },
      {
        description: "Un agent demande un am√©nagement de poste.",
        choices: [
          { text: "√âtude m√©dicale et poste adapt√©", effect: +10, feedback: "Exemplaire." },
          { text: "Refus direct", effect: -15, feedback: "Contre les obligations." },
          { text: "Proposition partielle", effect: +5, feedback: "Acceptable." },
          { text: "Reporter la d√©cision", effect: -5, feedback: "Mauvais signal." },
          { text: "Rencontre avec le manager", effect: +8, feedback: "Bonne concertation." },
          { text: "Ignorer la demande", effect: -10, feedback: "Risque de recours." }
        ]
      }
    ],
    "Responsable QSE": [
      {
        description: "Un agent chute sur le quai de transfert.",
        choices: [
          { text: "Ouvrir une enqu√™te imm√©diate", effect: +10, feedback: "Tr√®s bonne r√©activit√© s√©curit√©." },
          { text: "Bl√¢mer l‚Äôagent pour inattention", effect: -10, feedback: "Peu p√©dagogique." },
          { text: "Mettre √† jour le DUERP", effect: +5, feedback: "Bonne trace √©crite." },
          { text: "Organiser une causerie s√©curit√©", effect: +8, feedback: "Excellente initiative." },
          { text: "Ne rien faire", effect: -15, feedback: "Inacceptable." },
          { text: "Ajouter un marquage au sol", effect: +5, feedback: "Mesure pr√©ventive utile." }
        ]
      },
      {
        description: "Des d√©chets dangereux ont √©t√© trouv√©s m√©lang√©s aux ordures.",
        choices: [
          { text: "Isoler le contenant et informer l‚Äô√©quipe", effect: +10, feedback: "Bonne gestion imm√©diate." },
          { text: "Ignorer", effect: -15, feedback: "Grave manquement QSE." },
          { text: "Contacter le client fautif", effect: +5, feedback: "Bonne communication." },
          { text: "R√©aliser un affichage p√©dagogique", effect: +8, feedback: "Bonne pr√©vention." },
          { text: "Demander une sanction", effect: -5, feedback: "R√©action excessive." },
          { text: "Notifier la direction", effect: +5, feedback: "Bonne transparence." }
        ]
      }
    ],
    "Responsable d‚Äôatelier": [
      {
        description: "Une benne l√®ve-conteneurs ne fonctionne plus.",
        choices: [
          { text: "V√©rifier la pompe hydraulique", effect: +10, feedback: "Tr√®s bon r√©flexe technique." },
          { text: "Demander une pi√®ce sans diagnostic", effect: -5, feedback: "Proc√©dure incompl√®te." },
          { text: "Reporter la r√©paration", effect: -10, feedback: "Mauvaise gestion." },
          { text: "Affecter un autre v√©hicule", effect: +5, feedback: "Bonne alternative temporaire." },
          { text: "Informer le conducteur", effect: +8, feedback: "Bonne communication." },
          { text: "Ignorer", effect: -15, feedback: "Dangereux et inefficace." }
        ]
      },
      {
        description: "Un agent signale un bruit √©trange sur son camion.",
        choices: [
          { text: "Contr√¥ler imm√©diatement", effect: +10, feedback: "Excellent r√©flexe s√©curit√©." },
          { text: "Faire rouler quand m√™me", effect: -15, feedback: "Tr√®s risqu√©." },
          { text: "Reprogrammer la tourn√©e avec un autre v√©hicule", effect: +5, feedback: "Bonne adaptation." },
          { text: "Demander un test √† vide", effect: +8, feedback: "D√©marche prudente." },
          { text: "Reporter l‚Äôintervention", effect: -5, feedback: "Pas id√©al." },
          { text: "Remettre en service sans v√©rif", effect: -10, feedback: "D√©cision dangereuse." }
        ]
      }
    ],
    "Agent de ma√Ætrise": [
      {
        description: "Un √©quipier refuse de suivre son planning.",
        choices: [
          { text: "Le rencontrer pour comprendre", effect: +10, feedback: "Tr√®s bon leadership." },
          { text: "Le forcer √† l‚Äôappliquer", effect: -10, feedback: "Trop autoritaire." },
          { text: "R√©adapter les √©quipes", effect: +5, feedback: "Bonne gestion collective." },
          { text: "Informer les RH", effect: +8, feedback: "Bonne coordination." },
          { text: "Ignorer la situation", effect: -10, feedback: "Conflit potentiel." },
          { text: "Changer tout le planning", effect: -5, feedback: "Peu optimal." }
        ]
      },
      {
        description: "Un agent signale un manque de mat√©riel EPI.",
        choices: [
          { text: "R√©approvisionner imm√©diatement", effect: +10, feedback: "Priorit√© s√©curit√© respect√©e." },
          { text: "Dire d‚Äôutiliser un ancien", effect: -10, feedback: "Inacceptable." },
          { text: "Pr√©venir le responsable QSE", effect: +5, feedback: "Bonne coop√©ration." },
          { text: "Reporter la tourn√©e", effect: +8, feedback: "Mesure prudente." },
          { text: "Bl√¢mer l‚Äôagent", effect: -8, feedback: "Injuste." },
          { text: "Ignorer", effect: -15, feedback: "Grave erreur." }
        ]
      }
    ],
    "Chef d‚Äô√©quipe": [
      {
        description: "Un √©quipier revient sans avoir collect√© un bac signal√©.",
        choices: [
          { text: "V√©rifier l‚Äôinfo et renvoyer l‚Äô√©quipe", effect: +10, feedback: "Tr√®s bonne rigueur." },
          { text: "Noter sans agir", effect: -10, feedback: "Pas de correction." },
          { text: "Appeler le client", effect: +5, feedback: "Bonne communication." },
          { text: "Bl√¢mer l‚Äô√©quipier devant tous", effect: -10, feedback: "Pas de bonne pratique." },
          { text: "Ajouter l‚Äôadresse au lendemain", effect: +8, feedback: "Mesure r√©active." },
          { text: "Ignorer", effect: -15, feedback: "Erreur client non trait√©e." }
        ]
      },
      {
        description: "Un agent refuse de monter √† l‚Äôarri√®re du camion sans gants.",
        choices: [
          { text: "Fournir les EPI manquants", effect: +10, feedback: "Parfait." },
          { text: "Lui dire de monter quand m√™me", effect: -15, feedback: "Mise en danger." },
          { text: "Reporter la tourn√©e", effect: +5, feedback: "Solution prudente." },
          { text: "Demander √† un rempla√ßant", effect: +8, feedback: "R√©activit√© OK." },
          { text: "Bl√¢mer l‚Äôagent", effect: -10, feedback: "Injuste." },
          { text: "Ignorer", effect: -15, feedback: "Inacceptable." }
        ]
      }
    ]
  };

function startGame() {
  const nameInput = document.getElementById('playerName').value.trim();
  if (nameInput === "") {
    alert("Veuillez entrer votre nom avant de commencer !");
    return;
  }
  window.currentPlayerName = nameInput;
  document.getElementById('welcome-screen').style.display = 'none';
  document.getElementById('role-selection').style.display = 'block';
}


  function selectRole(role) {
    selectedRole = role;
    document.getElementById('role-info').innerText =
      `${role} ‚Äì Comp√©tences : ${roles[role][0]} / ${roles[role][1]}`;
    document.getElementById('btn-start-event').style.display = 'inline-block';
  }

  function startEvent() {
    eventCount++;
    if (eventCount > maxEvents || reputation <= 0) return endGame();

    document.getElementById('role-selection').style.display = 'none';
    document.getElementById('game-container').style.display = 'block';
   document.getElementById('feedback').innerText = "";
document.getElementById('choices-container').innerHTML = "";
document.getElementById('next-button').style.display = 'none';


    const events = eventsByRole[selectedRole];
    const randomEvent = events[Math.floor(Math.random() * events.length)];
    document.getElementById('event-title').innerText = selectedRole;
    document.getElementById('event-description').innerText = randomEvent.description;

    randomEvent.choices.forEach(choice => {
      const btn = document.createElement('button');
      btn.innerText = choice.text;
      btn.className = 'choice-button';
      btn.onclick = function () {
        handleChoice(choice);
      };
      document.getElementById('choices-container').appendChild(btn);
    });
  }

  function handleChoice(choice) {
    reputation = Math.max(0, Math.min(100, reputation + choice.effect));
    document.getElementById('reputation-bar').value = reputation;
    document.getElementById('reputation-value').innerText = `${reputation} / 100`;
    document.getElementById('feedback').innerText = choice.feedback;

    const allButtons = document.querySelectorAll('.choice-button');
    allButtons.forEach(btn => btn.disabled = true);

    document.getElementById('next-button').style.display = 'inline-block';

    const log = document.createElement('li');
    log.innerText = `üéØ ${document.getElementById('event-description').innerText} ‚Üí ‚úÖ ${choice.text} [R√©putation : ${reputation}]`;
    document.getElementById('history-log').appendChild(log);
  }

function endGame() {
  document.getElementById('feedback').innerText = "üéâ Fin de la partie !";
  document.getElementById('choices-container').innerHTML = "";
  document.getElementById('next-button').style.display = 'none';

  let medal = "";
  let color = "";
  let image = "";

  if (reputation === 0) {
    medal = "üí• √âchec total ‚Äì L‚Äôagence ferme ses portes !";
    color = "darkred";
    image = "fermeture.png";
  } else if (reputation >= 80) {
    medal = "ü•á M√©daille d'OR";
    color = "gold";
    image = "podium.png";
  } else if (reputation >= 40) {
    medal = "ü•à M√©daille d'ARGENT";
    color = "silver";
    image = "podium.png";
  } else {
    medal = "ü•â M√©daille de BRONZE";
    color = "#cd7f32";
    image = "podium.png";
  }

  const resultText = `
    üö© Partie termin√©e apr√®s ${eventCount} √©v√©nements.<br>
    Score final : ${reputation}/100<br>
    <span style="font-size: 22px; color: ${color}; font-weight: bold;">${medal}</span><br>
    <img src="${image}" alt="r√©sultat final" style="margin-top: 15px; max-width: 400px;">
  `;

  document.getElementById('feedback').innerHTML = resultText;

  const endLog = document.createElement('li');
  endLog.innerHTML = resultText;
  document.getElementById('history-log').appendChild(endLog);
  saveScore(window.currentPlayerName, reputation, medal);

  document.getElementById('restart-button').style.display = 'inline-block';
}

function restartGame() {
  reputation = 50;
  eventCount = 0;
  document.getElementById('reputation-bar').value = reputation;
  document.getElementById('reputation-value').innerText = "50 / 100";
  document.getElementById('history-log').innerHTML = "";
  document.getElementById('feedback').innerHTML = "";
  document.getElementById('choices-container').innerHTML = "";
  document.getElementById('next-button').style.display = 'none';
  document.getElementById('restart-button').style.display = 'none';
  document.getElementById('role-selection').style.display = 'block';
  document.getElementById('game-container').style.display = 'none';
}
function saveScore(name, score, medal) {
  fetch("https://script.google.com/macros/s/AKfycbzjvtoIp9X7vk5R0WzeAJa7kyQQdR5D8NyAViGVxtBQ62G0rcSqB81v0OCBx5WFQesx/exec", {
    method: "POST",
    mode: "no-cors",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      name: name,
      score: score,
      medal: medal
    }),
  });
}




// Appel automatique √† l'ouverture de la page
window.onload = function () {
  fetchScoresFromSheet();
};



</script>
</body>
</html>
